(()=>{'use strict';const SECTION=document.getElementById('problem-solving');if(!SECTION)return;const STORAGE_KEY='ps:entries:v1';const $=(s,r=SECTION)=>r.querySelector(s);const $$=(s,r=SECTION)=>Array.from(r.querySelectorAll(s));const today=()=>new Date().toISOString().slice(0,10);const uuid=()=>crypto.randomUUID?crypto.randomUUID():(Date.now().toString(36)+Math.random().toString(36).slice(2,10));const normalize=u=>!u?'':(/^https?:\/\//.test(u)?u:`https://${u}`);const toast=m=>{const n=$('#ps-toast');if(!n)return;n.textContent=m;n.hidden=false;setTimeout(()=>n.hidden=true,1600)};function load(){try{const raw=localStorage.getItem(STORAGE_KEY);if(!raw)return{schema:'ps-v1',updatedAt:new Date().toISOString(),items:[]};return JSON.parse(raw)}catch{return{schema:'ps-v1',updatedAt:new Date().toISOString(),items:[]}}}function save(d){localStorage.setItem(STORAGE_KEY,JSON.stringify(d))}const TPL=`<div class="ps__bg" aria-hidden="true"></div><div class="container"><header class="ps__header" aria-labelledby="ps-title"><div class="ps__header-left"><h2 id="ps-title" class="ps__title">Problem Solving — Active</h2><p class="ps__subtitle">Daily practice across DS & Algo to sharpen problem-solving.</p><div class="ps__meta"><span id="ps-last-updated" class="ps__updated" aria-live="polite">Last updated: —</span><button id="ps-motion-toggle" class="ps-btn ps-btn--ghost" type="button" aria-pressed="false" title="Toggle motion">Motion</button><button id="ps-review-filter" class="ps-btn ps-btn--ghost" type="button" aria-pressed="false" title="Show review queue">Review Queue</button></div></div><div class="ps__header-actions" role="group" aria-label="Data actions"><button id="ps-add-open" class="ps-btn ps-btn--primary" type="button" title="Quick add">Quick Add</button><button id="ps-export" class="ps-btn ps-btn--secondary" type="button" title="Export JSON">Export JSON</button><button id="ps-import-open" class="ps-btn ps-btn--secondary" type="button" title="Import JSON / CSV">Import</button><button id="ps-share" class="ps-btn ps-btn--secondary" type="button" title="Copy share summary">Copy Summary</button></div></header><div id="ps-reminder" class="ps-reminder" role="status" aria-live="polite" hidden><span>Keep the streak! No entry for today yet.</span><div class="ps-reminder__actions"><button id="ps-reminder-add" class="ps-btn ps-btn--tiny ps-btn--primary" type="button">Add Now</button><button id="ps-reminder-dismiss" class="ps-btn ps-btn--tiny ps-btn--ghost" type="button">Dismiss Today</button></div></div><section class="ps-kpis" aria-label="Key performance indicators"><div class="ps-kpi"><div class="ps-kpi__icon">🚀</div><div class="ps-kpi__body"><div class="ps-kpi__label">Total Solved</div><div id="ps-kpi-total" class="ps-kpi__value">0</div></div></div><div class="ps-kpi"><div class="ps-kpi__icon">🔥</div><div class="ps-kpi__body"><div class="ps-kpi__label">Current Streak</div><div id="ps-kpi-streak" class="ps-kpi__value">0</div></div></div><div class="ps-kpi"><div class="ps-kpi__icon">🏆</div><div class="ps-kpi__body"><div class="ps-kpi__label">Best Streak</div><div id="ps-kpi-best" class="ps-kpi__value">0</div></div></div><div class="ps-kpi"><div class="ps-kpi__icon">📈</div><div class="ps-kpi__body"><div class="ps-kpi__label">Last 7 Days</div><div id="ps-kpi-7d" class="ps-kpi__value">0</div></div></div><div class="ps-kpi"><div class="ps-kpi__icon">⏱️</div><div class="ps-kpi__body"><div class="ps-kpi__label">Avg Time (mins)</div><div id="ps-kpi-avg" class="ps-kpi__value">0</div></div></div><div class="ps-kpi"><div class="ps-kpi__pill ps-kpi__pill--easy">E</div><div class="ps-kpi__pill ps-kpi__pill--med">M</div><div class="ps-kpi__pill ps-kpi__pill--hard">H</div><div class="ps-kpi__body"><div class="ps-kpi__label">% by Difficulty</div><div id="ps-kpi-diff" class="ps-kpi__value">—</div></div></div></section><section class="ps-activity"><div class="ps-heatmap-card"><div class="ps-card__head"><h3 class="ps-card__title">Last 12 Months</h3><div class="ps-legend" aria-hidden="true"><span class="ps-legend__label">Low</span><span class="ps-legend__box ps-legend__box--l0"></span><span class="ps-legend__box ps-legend__box--l1"></span><span class="ps-legend__box ps-legend__box--l2"></span><span class="ps-legend__box ps-legend__box--l3"></span><span class="ps-legend__box ps-legend__box--l4"></span><span class="ps-legend__label">High</span></div></div><div id="ps-heatmap" class="ps-heatmap" role="grid" aria-label="Calendar heatmap"></div><div id="ps-heatmap-hint" class="ps-heatmap__hint" aria-live="polite"></div></div><div class="ps-trends"><div class="ps-card"><div class="ps-card__head"><h3 class="ps-card__title">Weekly Solves</h3></div><canvas id="ps-weekly-canvas" class="ps-canvas" width="400" height="160" aria-label="Weekly solves chart"></canvas></div><div class="ps-card"><div class="ps-card__head"><h3 class="ps-card__title">Difficulty Breakdown</h3></div><canvas id="ps-donut-canvas" class="ps-canvas" width="240" height="160" aria-label="Difficulty donut chart"></canvas></div></div></section><section class="ps-filters" aria-label="Filters"><div class="ps-filters__row"><label class="ps-field"><span class="ps-field__label">Platform</span><select id="ps-filter-platform" class="ps-input"><option value="">All</option><option value="leetcode">LeetCode</option><option value="hackerrank">HackerRank</option><option value="codeforces">Codeforces</option><option value="gfg">GfG</option><option value="custom">Custom</option></select></label><fieldset class="ps-field" aria-label="Difficulty"><legend class="ps-field__label">Difficulty</legend><div class="ps-chipset" role="group" aria-label="Difficulty chips"><button type="button" data-diff="easy" class="ps-chip ps-chip--easy" aria-pressed="false">Easy</button><button type="button" data-diff="medium" class="ps-chip ps-chip--med" aria-pressed="false">Medium</button><button type="button" data-diff="hard" class="ps-chip ps-chip--hard" aria-pressed="false">Hard</button></div></fieldset><label class="ps-field ps-field--grow"><span class="ps-field__label">Search</span><input id="ps-filter-search" class="ps-input" type="search" placeholder="Title, notes, tags…" /></label></div><div class="ps-filters__row"><label class="ps-field"><span class="ps-field__label">Tags</span><input id="ps-filter-tags" class="ps-input" list="ps-tags-datalist" placeholder="e.g. dp, graph" /><datalist id="ps-tags-datalist"></datalist></label><label class="ps-field"><span class="ps-field__label">From</span><input id="ps-filter-from" class="ps-input" type="date" /></label><label class="ps-field"><span class="ps-field__label">To</span><input id="ps-filter-to" class="ps-input" type="date" /></label><div class="ps-filters__actions"><button id="ps-clear-filters" class="ps-btn ps-btn--ghost" type="button">Clear All</button></div></div></section><section class="ps-list" aria-label="Problems list"><div id="ps-empty" class="ps-empty" hidden><div class="ps-empty__icon">🛰️</div><p class="ps-empty__text">No entries yet. Start with a Quick Add or Import.</p><div class="ps-empty__actions"><button class="ps-btn ps-btn--primary" id="ps-empty-add">Quick Add</button><button class="ps-btn ps-btn--secondary" id="ps-empty-import">Import</button></div></div><div id="ps-cards" class="ps-cards" role="list" aria-live="polite"></div><div id="ps-load-more" class="ps-load-more" hidden><button class="ps-btn ps-btn--secondary" type="button">Load More</button></div></section></div><dialog id="ps-add-modal" class="ps-modal" aria-labelledby="ps-add-title"><form id="ps-add-form" class="ps-form" method="dialog"><header class="ps-modal__header"><h3 id="ps-add-title" class="ps-modal__title">Quick Add</h3><button id="ps-add-close" class="ps-icon-btn" type="button" aria-label="Close">✕</button></header><div class="ps-modal__grid"><label class="ps-field ps-field--grow"><span class="ps-field__label">Title *</span><input name="title" class="ps-input" required placeholder="Two Sum" /></label><label class="ps-field"><span class="ps-field__label">Platform *</span><select name="platform" class="ps-input" required><option value="leetcode">LeetCode</option><option value="hackerrank">HackerRank</option><option value="codeforces">Codeforces</option><option value="gfg">GfG</option><option value="custom">Custom</option></select></label><fieldset class="ps-field"><legend class="ps-field__label">Difficulty *</legend><div class="ps-radio"><label><input type="radio" name="difficulty" value="easy" required/> Easy</label><label><input type="radio" name="difficulty" value="medium"/> Medium</label><label><input type="radio" name="difficulty" value="hard"/> Hard</label></div></fieldset><label class="ps-field"><span class="ps-field__label">Tags (comma)</span><input name="tags" class="ps-input" placeholder="array, hashmap" /></label><label class="ps-field ps-field--grow"><span class="ps-field__label">Link</span><input name="link" class="ps-input" placeholder="https://leetcode.com/problems/two-sum/" /></label><label class="ps-field"><span class="ps-field__label">Time (mins)</span><input name="timeMins" class="ps-input" type="number" min="0" max="999" inputmode="numeric" /></label><label class="ps-field"><span class="ps-field__label">Status *</span><select name="status" class="ps-input" required><option value="solved">Solved</option><option value="review">Review</option><option value="todo">Todo</option></select></label><label class="ps-field"><span class="ps-field__label">Date *</span><input name="date" class="ps-input" type="date" required /></label><label class="ps-field ps-field--full"><span class="ps-field__label">Notes</span><textarea name="notes" class="ps-input" rows="3" placeholder="Brief reflection…"></textarea></label></div><footer class="ps-modal__footer"><div class="ps-quickfill"><button type="button" data-q="today" class="ps-btn ps-btn--ghost">Today</button><button type="button" data-q="easy" class="ps-btn ps-btn--ghost">Easy</button><button type="button" data-q="medium" class="ps-btn ps-btn--ghost">Medium</button><button type="button" data-q="hard" class="ps-btn ps-btn--ghost">Hard</button><button type="button" data-q="tags:array,dp" class="ps-btn ps-btn--ghost">+Array/DP</button></div><div class="ps-modal__actions"><button class="ps-btn ps-btn--secondary" type="button" id="ps-add-cancel">Cancel</button><button class="ps-btn ps-btn--primary" type="submit">Add</button></div></footer></form></dialog><dialog id="ps-import-modal" class="ps-modal" aria-labelledby="ps-import-title"><div class="ps-form"><header class="ps-modal__header"><h3 id="ps-import-title" class="ps-modal__title">Import</h3><button id="ps-import-close" class="ps-icon-btn" type="button" aria-label="Close">✕</button></header><div class="ps-modal__grid"><div class="ps-card ps-card--sub"><h4 class="ps-card__title">JSON</h4><p class="ps-card__text">Import a previously exported JSON file.</p><div class="ps-row"><input id="ps-import-file" class="ps-input" type="file" accept="application/json" /><button id="ps-import-json" class="ps-btn ps-btn--secondary" type="button">Import JSON</button></div></div><div class="ps-card ps-card--sub"><h4 class="ps-card__title">Paste CSV/TSV</h4><p class="ps-card__text">Columns: title, platform, difficulty, tags, link, status, time, date, notes</p><textarea id="ps-import-text" class="ps-input" rows="6" placeholder="title,platform,difficulty,tags,link,status,time,date,notes"></textarea><div class="ps-row ps-row--end"><button id="ps-import-paste" class="ps-btn ps-btn--secondary" type="button">Import Pasted Data</button></div></div></div><footer class="ps-modal__footer"><div class="ps-modal__actions"><button class="ps-btn ps-btn--ghost" id="ps-import-cancel" type="button">Close</button></div></footer></div></dialog><div id="ps-toast" class="ps-toast" role="status" aria-live="polite" hidden></div>`;SECTION.classList.add('ps');SECTION.innerHTML=TPL;const data=load();const filter={platform:'',diffs:new Set(),tags:new Set(),search:'',from:'',to:'',day:''};let reviewOnly=false;const win={size:30,index:0};const fmtM=(m)=>m==null?'—':`${m}m`;const esc=s=>(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));function groupByDay(items){const m=new Map();for(const it of items){if(!it.date)continue;const a=m.get(it.date)||[];a.push(it);m.set(it.date,a)}return m}function streak(map){const t=today();const dates=[...map.keys()].sort();const set=new Set(dates);let cur=0,best=0,tmp=0,prev=null;for(const d of dates){if(prev){const p=new Date(prev);p.setDate(p.getDate()+1);const ps=p.toISOString().slice(0,10);tmp=d===ps?tmp+1:1}else tmp=1;best=Math.max(best,tmp);prev=d}let cd=t;while(set.has(cd)){cur++;const p=new Date(cd);p.setDate(p.getDate()-1);cd=p.toISOString().slice(0,10)}return{current:cur,best}}function lastNDays(n){const a=[];const end=new Date();for(let i=n-1;i>=0;i--){const d=new Date(end);d.setDate(end.getDate()-i);a.push(d.toISOString().slice(0,10))}return a}function weeklyBuckets(n){const arr=[];const now=new Date();const end=new Date(now);const day=end.getDay();end.setDate(end.getDate()-day+6);end.setHours(0,0,0,0);for(let i=0;i<n;i++){const e=new Date(end);e.setDate(e.getDate()-(7*i));const s=new Date(e);s.setDate(s.getDate()-6);arr.unshift({start:s.toISOString().slice(0,10),end:e.toISOString().slice(0,10)})}return arr}function renderHeader(){const m=groupByDay(data.items);const s=streak(m);$('#ps-last-updated').textContent=`Last updated: ${new Date(data.updatedAt||Date.now()).toLocaleString()}`;$('#ps-kpi-streak').textContent=s.current;$('#ps-kpi-best').textContent=s.best;const last7=lastNDays(7);let c7=0,sum=0,cnt=0;const diff={easy:0,medium:0,hard:0};for(const it of data.items){if(it.status!=='todo'&&last7.includes(it.date))c7++;if(it.timeMins!=null){sum+=Number(it.timeMins);cnt++;}if(diff[it.difficulty]!=null&&it.status!=='todo')diff[it.difficulty]++;}$('#ps-kpi-7d').textContent=c7;$('#ps-kpi-total').textContent=data.items.filter(x=>x.status!=='todo').length;$('#ps-kpi-avg').textContent=cnt?Math.round(sum/cnt):0;const total=diff.easy+diff.medium+diff.hard;const pct=total?[Math.round(100*diff.easy/total),Math.round(100*diff.medium/total),Math.round(100*diff.hard/total)]:[0,0,0];$('#ps-kpi-diff').textContent=`E:${pct[0]}% M:${pct[1]}% H:${pct[2]}%`}function renderHeatmap(){const cont=$('#ps-heatmap');const hint=$('#ps-heatmap-hint');cont.innerHTML='';const map=groupByDay(data.items);for(const d of lastNDays(365)){const c=(map.get(d)||[]).filter(x=>x.status!=='todo').length;const lvl=c>=4?4:c;const el=document.createElement('button');el.type='button';el.className=`ps-heat ${lvl?`ps-heat--l${lvl}`:''}`;el.title=`${d} — ${c} solved`;el.setAttribute('aria-label',el.title);el.dataset.date=d;el.addEventListener('mouseenter',()=>hint.textContent=el.title);el.addEventListener('mouseleave',()=>hint.textContent='');el.addEventListener('click',()=>{filter.day=filter.day===d?'':d;renderAll()});cont.appendChild(el)}}function renderWeekly(){const ctx=$('#ps-weekly-canvas').getContext('2d');const w=ctx.canvas.width,h=ctx.canvas.height;ctx.clearRect(0,0,w,h);const weeks=weeklyBuckets(26);const counts=weeks.map(({start,end})=>data.items.filter(x=>x.date>=start&&x.date<=end&&x.status!=='todo').length);const max=Math.max(1,...counts);ctx.strokeStyle='rgba(255,255,255,.12)';ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(30,h-24);ctx.lineTo(w-10,h-24);ctx.stroke();const plotW=w-44;const barW=plotW/counts.length;for(let i=0;i<counts.length;i++){const v=counts[i];const bh=Math.round((h-44)*v/max);const x=30+i*barW+2;const y=h-24-bh;ctx.fillStyle='rgba(0,212,255,.6)';ctx.fillRect(x,y,Math.max(4,barW-4),bh)}}function renderDonut(){const ctx=$('#ps-donut-canvas').getContext('2d');const w=ctx.canvas.width,h=ctx.canvas.height;ctx.clearRect(0,0,w,h);const c={easy:0,medium:0,hard:0};for(const it of data.items)if(it.status!=='todo'&&c[it.difficulty]!=null)c[it.difficulty]++;const vals=[c.easy,c.medium,c.hard];const colors=['#4ecdc4','#ffe66d','#ff6b6b'];const total=Math.max(1,vals.reduce((a,b)=>a+b,0));const cx=w/2,cy=h/2,r=Math.min(w,h)/2-10;let start=-Math.PI/2;for(let i=0;i<vals.length;i++){const ang=2*Math.PI*(vals[i]/total);ctx.beginPath();ctx.fillStyle=colors[i];ctx.moveTo(cx,cy);ctx.arc(cx,cy,r,start,start+ang);ctx.closePath();ctx.fill();start+=ang}ctx.globalCompositeOperation='destination-out';ctx.beginPath();ctx.arc(cx,cy,r*0.56,0,Math.PI*2);ctx.fill();ctx.globalCompositeOperation='source-over'}function collectFilters(){filter.platform=$('#ps-filter-platform').value.trim().toLowerCase();filter.search=$('#ps-filter-search').value.trim().toLowerCase();filter.from=$('#ps-filter-from').value||'';filter.to=$('#ps-filter-to').value||'';filter.tags=new Set(($('#ps-filter-tags').value||'').split(/[, ]+/).map(t=>t.trim().toLowerCase()).filter(Boolean))}function applyFilters(items){return items.filter(it=>{if(reviewOnly&&it.status!=='review')return false;if(filter.platform&&it.platform!==filter.platform)return false;if(filter.diffs.size&&!filter.diffs.has(it.difficulty))return false;if(filter.day&&it.date!==filter.day)return false;if(filter.from&&it.date<filter.from)return false;if(filter.to&&it.date>filter.to)return false;if(filter.tags.size){const tags=new Set((it.tags||[]).map(t=>t.toLowerCase()));for(const t of filter.tags)if(!tags.has(t))return false}if(filter.search){const hay=[it.title,it.notes,(it.tags||[]).join(' ')].join(' ').toLowerCase();if(!hay.includes(filter.search))return false}return true})}function renderList(){const container=$('#ps-cards');container.innerHTML='';const all=applyFilters(data.items);$('#ps-empty').hidden=all.length!==0;const end=Math.min(win.index+win.size,all.length);const slice=all.slice(0,end);slice.forEach(it=>container.appendChild(card(it)));const lm=$('#ps-load-more');lm.hidden=end>=all.length;lm.querySelector('button').onclick=()=>{win.index+=win.size;renderList()};const set=new Set();data.items.forEach(x=>(x.tags||[]).forEach(t=>set.add(t)));const dl=$('#ps-tags-datalist');dl.innerHTML='';[...set].sort().forEach(t=>{const o=document.createElement('option');o.value=t;dl.appendChild(o)})}function card(it){const el=document.createElement('article');el.className='ps-card-item';const diffClass=it.difficulty==='hard'?'ps-chip--diff-hard':(it.difficulty==='medium'?'ps-chip--diff-medium':'ps-chip--diff-easy');el.innerHTML=`<div class="ps-card-item__top"><div><h4 class="ps-card-item__title">${it.link?`<a href="${normalize(it.link)}" target="_blank" rel="noopener">${esc(it.title)}</a>`:esc(it.title)}</h4><div class="ps-card-item__meta"><span class="ps-chip ${diffClass}">${it.difficulty||'—'}</span><span class="ps-chip ps-chip--tag">${it.platform||'—'}</span><span class="ps-chip ps-chip--tag">${it.date||'—'}</span><span class="ps-chip ps-chip--tag">${it.status}</span><span class="ps-chip ps-chip--tag">${fmtM(it.timeMins)}</span></div></div><div class="ps-card-item__actions"><button class="ps-btn ps-btn--ghost" data-action="review" data-id="${it.id}">${it.status==='review'?'Unmark Review':'Mark Review'}</button><button class="ps-btn ps-btn--secondary" data-action="edit" data-id="${it.id}">Edit</button><button class="ps-btn ps-btn--ghost" data-action="delete" data-id="${it.id}">Delete</button></div></div>${it.tags&&it.tags.length?`<div class="ps-card-item__meta">${it.tags.map(t=>`<span class=\"ps-chip ps-chip--tag\">${esc(t)}</span>`).join('')}</div>`:''}${it.notes?`<div class="ps-card-item__notes" data-notes>${esc(it.notes.length>220?it.notes.slice(0,217)+'…':it.notes)} ${it.notes.length>220?`<a href=\"#\" data-more>Show more</a>`:''}</div>`:''}`;el.addEventListener('click',e=>{const a=e.target.closest('[data-action]');if(!a)return;const id=a.getAttribute('data-id');if(a.dataset.action==='delete'){if(confirm('Delete this entry?')){data.items=data.items.filter(x=>x.id!==id);data.updatedAt=new Date().toISOString();save(data);refresh();toast('Deleted.')}}else if(a.dataset.action==='review'){const it=data.items.find(x=>x.id===id);if(it){it.status=it.status==='review'?'solved':'review';data.updatedAt=new Date().toISOString();save(data);refresh();toast('Updated review flag.')}}else if(a.dataset.action==='edit'){openEdit(id)}});el.addEventListener('click',e=>{const m=e.target.closest('[data-more]');if(!m)return;e.preventDefault();const n=el.querySelector('[data-notes]');const full=data.items.find(x=>x.id===it.id);if(full&&n)n.textContent=full.notes||''});return el}function setAddDefaults(){const f=$('#ps-add-form');f.title.value='';f.platform.value='leetcode';f.difficulty.value='';f.tags.value='';f.link.value='';f.timeMins.value='';f.status.value='solved';f.date.value=today();f.notes.value=''}function openAdd(){setAddDefaults();const m=$('#ps-add-modal');m.showModal();$('#ps-add-close').onclick=()=>m.close();$('#ps-add-cancel').onclick=()=>m.close()}function readForm(f){const title=f.title.value.trim();const platform=f.platform.value.trim().toLowerCase();const df=(new FormData(f).get('difficulty')||'').toString().toLowerCase();const tags=(f.tags.value||'').split(/[, ]+/).map(t=>t.trim().toLowerCase()).filter(Boolean);const link=normalize(f.link.value.trim());const time=f.timeMins.value?Number(f.timeMins.value):null;const status=f.status.value.trim().toLowerCase();const date=f.date.value;const notes=f.notes.value.trim();if(!title||!platform||!df||!status||!date){toast('Please fill required fields.');return null}return{title,platform,difficulty:df,tags,link,timeMins:time,status,date,notes}}function initQuickfill(){$$('#ps-add-form .ps-quickfill [data-q]').forEach(b=>{b.onclick=()=>{const q=b.getAttribute('data-q');const f=$('#ps-add-form');if(q==='today')f.date.value=today();else if(q==='easy'||q==='medium'||q==='hard')f.difficulty.value=q;else if(q.startsWith('tags:'))f.tags.value=q.split(':')[1]}})}function initAddHandler(){const f=$('#ps-add-form');f.onsubmit=(e)=>{e.preventDefault();const entry=readForm(f);if(!entry)return;data.items.unshift({id:uuid(),...entry});data.updatedAt=new Date().toISOString();save(data);refresh();$('#ps-add-modal').close();toast('Added.')}}function openEdit(id){const it=data.items.find(x=>x.id===id);if(!it)return;const f=$('#ps-add-form');f.title.value=it.title||'';f.platform.value=it.platform||'leetcode';f.difficulty.value=it.difficulty||'';f.tags.value=(it.tags||[]).join(', ');f.link.value=it.link||'';f.timeMins.value=it.timeMins??'';f.status.value=it.status||'solved';f.date.value=it.date||today();f.notes.value=it.notes||'';const m=$('#ps-add-modal');m.showModal();$('#ps-add-close').onclick=()=>m.close();$('#ps-add-cancel').onclick=()=>m.close();f.onsubmit=(e)=>{e.preventDefault();const entry=readForm(f);if(!entry)return;Object.assign(it,entry);data.updatedAt=new Date().toISOString();save(data);refresh();m.close();toast('Updated.');initAddHandler()}}function exportJSON(){const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='problem-solving.json';document.body.appendChild(a);a.click();a.remove()}async function importJSONFile(){const f=$('#ps-import-file').files[0];if(!f){toast('Select a JSON file.');return}try{const txt=await f.text();const obj=JSON.parse(txt);if(!obj.items||!Array.isArray(obj.items))throw new Error('Invalid');data.items=merge(data.items,obj.items);data.updatedAt=new Date().toISOString();save(data);refresh();toast('Imported JSON.')}catch{toast('Import failed')}}function importPasted(){const txt=$('#ps-import-text').value.trim();if(!txt){toast('Paste CSV/TSV content.');return}const rows=parseCSV(txt);const items=[];for(const r of rows){const[title,platform,difficulty,tags,link,status,time,date,notes]=r;if(!title||!platform||!difficulty||!status||!date)continue;items.push({id:uuid(),title:String(title).trim(),platform:String(platform).trim().toLowerCase(),difficulty:String(difficulty).trim().toLowerCase(),tags:(String(tags||'').split(/[, ]+/).map(t=>t.trim().toLowerCase()).filter(Boolean)),link:normalize(String(link||'')),status:String(status).trim().toLowerCase(),timeMins:time?Number(time):null,date:String(date).trim(),notes:String(notes||'').trim()})}if(!items.length){toast('No valid rows found.');return}data.items=merge(data.items,items);data.updatedAt=new Date().toISOString();save(data);refresh();toast(`Imported ${items.length} row(s).`)}function merge(existing,incoming){const key=x=>`${x.platform}|${(x.sourceId||'')||x.title}|${x.date}`;const m=new Map(existing.map(x=>[key(x),x]));for(const it of incoming)m.set(key(it),{...it,id:uuid()});return[...m.values()].sort((a,b)=>b.date.localeCompare(a.date))}function parseCSV(text){const sep=text.includes('\t')?'\t':',';return text.split(/\r?\n/).filter(Boolean).map(l=>l.split(sep).map(s=>s.replace(/^"(.*)"$/,'$1').trim()))}function copyShare(){const month=new Date().toISOString().slice(0,7);const monthItems=data.items.filter(x=>(x.date||'').startsWith(month)&&x.status!=='todo');const c={easy:0,medium:0,hard:0};monthItems.forEach(x=>c[x.difficulty]=(c[x.difficulty]||0)+1);const tags=new Map();data.items.forEach(x=>(x.tags||[]).forEach(t=>tags.set(t,(tags.get(t)||0)+1)));const top=[...tags.entries()].sort((a,b)=>b[1]-a[1]).slice(0,2).map(([t])=>t);const s=streak(groupByDay(data.items)).current;const text=`Solved ${monthItems.length} problems this month (M/E/H: ${c.medium||0}/${c.easy||0}/${c.hard||0}). Current streak: ${s} days. Focus: ${top.join(', ')||'DSA'}.`;navigator.clipboard.writeText(text).then(()=>toast('Summary copied!')).catch(()=>toast('Copy failed'))}function showReminder(){const key='ps:reminder:dismiss';const dismissed=localStorage.getItem(key)===today();const anyToday=data.items.some(x=>x.date===today()&&x.status!=='todo');const el=$('#ps-reminder');el.hidden=dismissed||anyToday;$('#ps-reminder-dismiss').onclick=()=>{localStorage.setItem(key,today());el.hidden=true};$('#ps-reminder-add').onclick=()=>openAdd()}function bind(){ $('#ps-add-open').onclick=openAdd; $('#ps-empty-add').onclick=openAdd; $('#ps-empty-import').onclick=()=>$('#ps-import-modal').showModal(); $('#ps-import-open').onclick=()=>$('#ps-import-modal').showModal(); $('#ps-import-close').onclick=()=>$('#ps-import-modal').close(); $('#ps-import-cancel').onclick=()=>$('#ps-import-modal').close(); $('#ps-add-close').onclick=()=>$('#ps-add-modal').close(); $('#ps-add-cancel').onclick=()=>$('#ps-add-modal').close(); $('#ps-export').onclick=exportJSON; $('#ps-import-json').onclick=importJSONFile; $('#ps-import-paste').onclick=importPasted; $('#ps-share').onclick=copyShare; $('#ps-motion-toggle').onclick=(e)=>{const p=e.currentTarget;const v=p.getAttribute('aria-pressed')==='true';p.setAttribute('aria-pressed',String(!v));SECTION.classList.toggle('ps-motion-off',!v)}; $('#ps-review-filter').onclick=(e)=>{const v=e.currentTarget.getAttribute('aria-pressed')==='true';e.currentTarget.setAttribute('aria-pressed',String(!v));reviewOnly=!v;renderAll();}; $('#ps-filter-platform').onchange=()=>{collectFilters();win.index=0;renderAll()}; $('#ps-filter-search').oninput=()=>{collectFilters();win.index=0;renderAll()}; $('#ps-filter-tags').oninput=()=>{collectFilters();win.index=0;renderAll()}; $('#ps-filter-from').onchange=()=>{collectFilters();win.index=0;renderAll()}; $('#ps-filter-to').onchange=()=>{collectFilters();win.index=0;renderAll()}; $$('#problem-solving .ps-chipset [data-diff]').forEach(ch=>{ch.onclick=()=>{const d=ch.getAttribute('data-diff');const pressed=ch.getAttribute('aria-pressed')==='true';ch.setAttribute('aria-pressed',String(!pressed)); if(pressed)filter.diffs.delete(d);else filter.diffs.add(d);win.index=0;renderAll();}}); $('#ps-clear-filters').onclick=()=>{filter.platform='';filter.diffs=new Set();filter.tags=new Set();filter.search='';filter.from='';filter.to='';filter.day=''; $('#ps-filter-platform').value='';$('#ps-filter-search').value='';$('#ps-filter-tags').value='';$('#ps-filter-from').value='';$('#ps-filter-to').value=''; $$('#problem-solving .ps-chipset [data-diff]').forEach(ch=>ch.setAttribute('aria-pressed','false'));win.index=0;renderAll();}; }function renderAll(){renderHeader();renderHeatmap();renderList();renderWeekly();renderDonut();showReminder()}function init(){bind();initQuickfill();initAddHandler();$('#ps-add-form').date.value=today();renderAll()}init();})();
